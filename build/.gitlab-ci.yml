stages:
  - deploy

deploy-job:
  stage: deploy
  variables:
    SECURE_FILES_DOWNLOAD_PATH: '.ssh'
  script:
    - curl --silent "https://gitlab.com/gitlab-org/incubation-engineering/mobile-devops/download-secure-files/-/raw/main/installer" | bash
    - cp -r .ssh ~/.ssh
    - cd build
    - PRIVATE_KEY_PASSPHRASE="$passphrase" bash sign-script.sh BiliBiliScript.js > results.txt
    - cat results.txt
    - bash add-signature.sh results.txt BiliBiliConfig.json
    - cat BiliBiliConfig.json
  artifacts:
    paths:
      - build/BiliBiliConfig.json
      - build/BiliBiliScript.js
      - build/BiliBiliIcon.png
